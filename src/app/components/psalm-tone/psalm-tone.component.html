<main class="main">
  <div class="controls">
    <div class="control-group">
      <label for="psalm-select">Select Psalm:</label>
      <select
        id="psalm-select"
        [value]="selectedPsalmNumber()"
        (change)="onPsalmChange($event)"
        class="select-control"
      >
        @for (option of psalmOptions; track option.display) {
        <option [value]="option.psalm_number">{{ option.display }}</option>
        }
      </select>
    </div>

    <div class="control-group">
      <label for="version-select">Version:</label>
      <select
        id="version-select"
        [value]="selectedPsalmVersion()"
        (change)="onVersionChange($event)"
        class="select-control"
      >
        @for (version of availableVersions; track version.id) {
        <option [value]="version.id">{{ version.name }}</option>
        }
      </select>
    </div>

    <div class="control-group">
      <label for="tone-select">Select Tone:</label>
      <select
        id="tone-select"
        [value]="selectedTone()"
        (change)="onToneChange($event)"
        class="select-control"
      >
        @for (tone of availableTones; track tone.filename) {
        <option [value]="tone.filename">{{ tone.displayName }}</option>
        }
      </select>
    </div>
  </div>

  <app-midi-player [selectedTone]="selectedTone()" />

  @if (psalm.isLoading()) {
  <div class="loading">
    <span>Loading psalm...</span>
  </div>
  } @else if (psalm.error()) {
  <div class="error">
    <p>Error loading psalm: {{ psalm.error() }}</p>
  </div>
  } @else if (psalm.value()) {
  <div class="psalm-content">
    <h1>Psalm {{ psalm.value()!.psalm_number }}</h1>
    @if (psalm.value()!.latin_name) {
    <h2 class="latin-name">{{ psalm.value()!.latin_name }}</h2>
    } @if (toneImagePath()) {
    <img [src]="toneImagePath()" alt="Psalm tone" class="tone-image" />
    }
    <pre class="psalm-text">{{
      psalm.value()!.annotated_text || psalm.value()!.text | verseBr
    }}</pre>
  </div>
  }
</main>
